[platformio]
src_dir = .

[env:esp32dev]
platform = espressif32@6.5.0
board = esp32dev
framework = arduino
monitor_speed = 115200

; Exclude conflicting libraries
lib_ignore = 
    WebServer
    ESPmDNS
    ArduinoOTA

lib_deps = 
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git
    bblanchon/ArduinoJson@^6.21.0
    h2zero/NimBLE-Arduino@^1.4.1

build_flags =
    -std=gnu++17
    -DCONFIG_BT_NIMBLE_ROLE_CENTRAL_DISABLED
    -DCONFIG_BT_NIMBLE_ROLE_OBSERVER_DISABLED
    ; Increase TCP timeout for large file transfers (default is 5000ms)
    -DCONFIG_ASYNC_TCP_RUNNING_CORE=1
    -DCONFIG_ASYNC_TCP_USE_WDT=0
    ; Increase buffer sizes for better performance with large files
    ; Use LWIP naming to avoid redefinition warnings
    -DCONFIG_LWIP_TCP_MSS=1436
    -DCONFIG_LWIP_TCP_SND_BUF_DEFAULT=5744
    -DCONFIG_LWIP_TCP_WND_DEFAULT=5744
